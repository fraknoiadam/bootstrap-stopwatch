<!doctype html>
	<html lang="en"> 
		<head>
			<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
			<meta name="description" content>
			<meta name="keywords" content>
			<meta name="author" content>
			<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
			<title>Countdown</title>
			<link href="css/bootstrap.min.css" rel="stylesheet"/>
			<link href="css/bootstrap-responsive.min.css" rel="stylesheet"/>
			<link href="css/font-awesome.css" rel="stylesheet">
			<link href="css/custom.css" rel="stylesheet"/>
		</head>
		<body>
			<header>
				<div class="container">
					<div class="center">
						<div id="stopWatch">
							<div class="row">
								<div class="span12">
									<div id="time" class="pointable" style="font-weight:bold; width:100%; display:block;">0:00:00</div>
								</div>
							</div>
						</div>
						<div id="information-for-competitors" style="display:none"></div>
					</div>
				</div>
				<div id=frame_form>
					<h3>How to use?</h3>
					<p> If you click on the timer, then it will start/pause.<br>
						There are some shortcuts that you can use any time.<br>
						If you want to hide these instructions, then click the button below and they will disappear and the window goes to fullscreen.  (Note: The timer won't start, if you click the button.)<br>
						Please note that if you close or refresh this tab, then the timer will be reset.
					</p>
					<h3>Shortcuts</h3>
					<table>
						<tr>
							<th>Shortcut</th>
							<th>Function</th>
						</tr>
						<tr>
							<td>alt+q, alt+Q</td>
							<td>Switch to dark mode and to light mode</td>
						</tr>
						<tr>
							<td>alt+h, alt+H</td>
							<td>Decrease and increase the timer by 1 hour</td>
						</tr>
						<tr>
							<td>alt+m, alt+M</td>
							<td>Decrease and increase the timer by 1 minute</td>
						</tr>
						<tr>
							<td>alt+s, alt+S</td>
							<td>Decrease and increase the timer by 1 second</td>
						</tr>
						<tr>
							<td>alt+b, alt+B</td>
							<td>Decrease and increase the size of the timer</td>
						</tr>
					</table>
					<p>Note: If you see a shortcut with uppercase e.g. "alt+A" then it is equivalent to the shortcut "alt+shift+a"</p>
					<button type="button" onclick="submit()">Hide the instructions!</button>
					<p>Before you hide the instructions, press F11 to fullscreen the window!</p>
				</div>
			</header>

			<!-- scripts -->
			<!-- 
			<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
			 -->
			<script type="text/javascript" src="js/jquery.1.9.1.min.js"></script>
			<script src="js/bootstrap.min.js"></script>
			<script src="js/custom.js"></script>
			<script src="js/jquery.fittext.js"></script>

			<script type="text/javascript">
			function submit(){
				document.getElementById("frame_form").style.display = "None"
			}

			$(document).ready(function(){
				document.getElementById("time").style.fontSize = "15rem"
				document.getElementsByClassName("center")[0].style.marginBottom = "0px"

				let startTime; 
				let timeout;
				let pauseTime = 0;
				let paused = false;
				let init = true
				let count = 0;
				let countdown = 16200
				let ask_question_from = 16199
				let ask_question_to = 14400 // Az első 30 percben kiírja azt is, hogy "You may ask questions."
				let leave_room_from = 1800
				let leave_room_to = 1 // Az utolsó 30 percben pirosra vált a felirat, és azt írja ki, hogy "You are not allowed to leave the room until the end of the competition."
				let mils = countdown*1000
				let moment_of_paused = 0
				let min_fade = 10
				displayMil(countdown*1000)

				$('#time').on('click', function(){
					if (init == true){
						init = false
						startTime = new Date();
						clock();
					} else {
						if(paused == false){
							paused = true;
							clearTimeout(timeout);	
							moment_of_paused = new Date();
							$('#time').addClass('paused');
						}else{
							paused = false;
							pauseTime = pauseTime + (new Date() - moment_of_paused);
							clock();
						}

					}
				});

				// Add event listener on keydown
				document.addEventListener('keydown', (event) => {
					var name = event.key;
					var code = event.code;
					if (event.altKey) {
						if (name === 'q'){
							document.documentElement.style.setProperty("--main-bg-color","rgb(255,255,255)")
							document.documentElement.style.setProperty("--main-txt-color","rgb(0,0,0)")
							document.documentElement.style.setProperty("--alert-color","rgb(255,0,0)")
						}
						if (name === 'Q'){
							document.documentElement.style.setProperty("--main-bg-color","rgb(19,19,19)")
							document.documentElement.style.setProperty("--main-txt-color","rgb(255,255,255)")
							document.documentElement.style.setProperty("--alert-color","rgb(255,255,0)")
						}
						if (name === 'b'){
							newFontSize = Math.max(0,parseInt(document.getElementById("time").style.fontSize)-1)
							document.getElementById("time").style.fontSize = newFontSize+"rem"
						}
						if (name === 'B'){
							document.getElementById("time").style.fontSize = (parseInt(document.getElementById("time").style.fontSize)+1)+"rem"
						}
						if (name === 'v'){
							newMarginBottom = Math.max(0,(parseInt(document.getElementsByClassName("center")[0].style.marginBottom)-1))
							document.getElementsByClassName("center")[0].style.marginBottom = newMarginBottom+"px"
						}
						if (name === 'V'){
							newMarginBottom = parseInt(document.getElementsByClassName("center")[0].style.marginBottom)+1
							document.getElementsByClassName("center")[0].style.marginBottom = newMarginBottom+"px"
						}
						if (name === 'h'){
							addSecondsToTimer(-3600)
						}
						if (name === 'H'){
							addSecondsToTimer(3600)
						}
						if (name === 'm'){
							addSecondsToTimer(-60)
						}
						if (name === 'M'){
							addSecondsToTimer(60)
						}
						if (name === 's'){
							addSecondsToTimer(-1)
						}
						if (name === 'S'){
							addSecondsToTimer(1)
						}
					}
				}, false);

				function addSecondsToTimer(sec) {
					countdown = Math.max(0,countdown+sec)
					mils = Math.max(0, mils+sec*1000)
					displayMil(mils)
				}

				function clock() {
					$('#time').removeClass('paused');
					var curTime = new Date();
					mils = -(curTime - startTime) + pauseTime + countdown*1000;
					mils = Math.max(mils,0) // prevent negative time
					displayMil(mils)
					timeout = setTimeout(clock,20);
				}

				function displayMil(mils){
					let time = milToTime(mils);
					formatTime(time);
					hours = parseInt(time.h)
					min = parseInt(time.m)
					sec = parseInt(time.s)
					if(hours*3600+min*60+sec <= ask_question_from && hours*3600+min*60+sec >= ask_question_to){
						document.getElementById("information-for-competitors").style.display = "block"
						document.getElementById("information-for-competitors").innerHTML = "You may ask questions."
					}
					else if(hours*3600+min*60+sec <= leave_room_from && hours*3600+min*60+sec >= leave_room_to){
						document.getElementById("information-for-competitors").style.display = "block"
						document.getElementById("information-for-competitors").classList.add("alert-text")
						document.getElementById("information-for-competitors").innerHTML = "You are not allowed to leave the room until the end of the competition."
					} else {
						document.getElementById("information-for-competitors").className = ""
						document.getElementById("information-for-competitors").innerHTML = ""
					}
					let outStr = time.h +':'+time.m +':'+time.s;
					document.getElementById('time').innerHTML=outStr;
				}
				
				function formatTime(time){
					for(var i in time){
						if(i == "mils"){
							if(time[i] < 1){
								time[i] = "000";
							}else if(time[i] < 10){
								time[i] = "00" + time[i];
							}else if(time[i] < 100){
								time[i] = "0" + time[i];
							}
						}else if(i != "h" && time[i] < 10){
							time[i] = "0" + time[i];
						}
					}
					return time;		
				}
				
				function milToTime(mil){
					mi = mil % 1000;
					seconds = parseInt(mil / 1000) % 60;
					minutes = parseInt(mil / 1000 / 60) % 60;
					hours = parseInt( mil / 1000 / 3600);
					return {s: seconds, m: minutes, h:hours, mils:mi};
				}
			});			
			</script>
		</body>
	</html>





